{"ast":null,"code":"import { fabric } from 'fabric';\nimport BoundingBox from '../assets/BoundingBox.js';\nimport History from '../assets/StateStore.js';\nexport default {\n  name: 'imageUpload',\n  props: {\n    canW: {\n      type: [String, Number],\n      required: true\n    },\n    canH: {\n      type: [String, Number],\n      required: true\n    }\n  },\n\n  data() {\n    return {\n      arr: [\"Poiesis\", \"ποίησις\"],\n      item: {\n        image: null,\n        imageUrl: null\n      },\n      canvas: null,\n      boundingBoxActive: false,\n      bgSet: false\n    };\n  },\n\n  mounted() {\n    this.canvas = new fabric.Canvas(this.$refs.can, {\n      selection: false\n    });\n    this.canvas.setDimensions({\n      width: this.canW,\n      height: this.canH\n    });\n    this.history = new History();\n  },\n\n  methods: {\n    turnOffListeners() {\n      if (this.boundingBoxActive) {\n        this.boundingBoxActive = !this.boundingBoxActive;\n      }\n\n      this.canvas.off('mouse:down').off('mouse:move').off('mouse:up');\n    },\n\n    // cursor(el){\n    //   gsap.to(el,{opacity:0,ease:\"power2.inOut\",repeat:-1})\n    // },\n    updateHistory() {\n      this.canvas.renderAll();\n      console.log(JSON.stringify(this.canvas));\n      this.history.push(JSON.stringify(this.canvas));\n    },\n\n    undoHistory() {\n      this.turnOffListeners();\n      this.canvas.loadFromJSON(this.history.undo());\n    },\n\n    redoHistory() {\n      this.turnOffListeners();\n      this.canvas.loadFromJSON(this.history.redo());\n    },\n\n    uploadFile(e) {\n      const file = e.target.files[0];\n      this.item.image = file;\n      this.item.imageUrl = URL.createObjectURL(file);\n      fabric.Image.fromURL(this.item.imageUrl, function (oImg) {\n        let imgWidth = oImg.width;\n        let imgHeight = oImg.height;\n        let imgRatio = imgWidth / imgHeight;\n        let canvasRatio = this.canW / this.canH;\n\n        if (imgRatio <= canvasRatio) {\n          if (imgHeight > this.canH) {\n            oImg.scaleToHeight(this.canH - 10);\n          }\n        } else {\n          if (imgWidth > this.canW) {\n            oImg.scaleToWidth(this.canW - 10);\n          }\n        }\n      }); // this.canvas.drawImage(this.item.imageUrl,0,0,200,200);\n\n      this.canvas.setBackgroundImage(this.item.imageUrl, this.canvas.renderAll.bind(this.canvas), {\n        width: this.canvas.width,\n        height: this.canvas.height,\n        originX: 'left',\n        originY: 'top'\n      });\n      this.canvas.renderAll();\n      this.bgSet = 1;\n    },\n\n    onBoundingBoxActive() {\n      if (this.bgSet) {\n        this.updateHistory();\n        this.bgSet = !this.bgSet;\n      }\n\n      this.boundingBoxActive = !this.boundingBoxActive;\n      BoundingBox(this.canvas, this.boundingBoxActive, this.history);\n    },\n\n    logCanvasData() {\n      console.log(JSON.stringify(this.canvas));\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["fabric","BoundingBox","History","name","props","canW","type","String","Number","required","canH","data","arr","item","image","imageUrl","canvas","boundingBoxActive","bgSet","mounted","Canvas","$refs","can","selection","setDimensions","width","height","history","methods","turnOffListeners","off","updateHistory","renderAll","console","log","JSON","stringify","push","undoHistory","loadFromJSON","undo","redoHistory","redo","uploadFile","e","file","target","files","URL","createObjectURL","Image","fromURL","oImg","imgWidth","imgHeight","imgRatio","canvasRatio","scaleToHeight","scaleToWidth","setBackgroundImage","bind","originX","originY","onBoundingBoxActive","logCanvasData"],"sourceRoot":"","sources":["/Users/boo/Desktop/poiesis/src/components/UploadButton.vue"],"sourcesContent":["<template>\n    <div class=\"container\">\n      <div class=\"col\">\n         <div class=\"navBar\">\n            <VueWriter :array=\"arr\" :typeSpeed=\"100\" :eraseSpeed=\"70\"  :delay=\"2000\"/>\n            <div class=\"something\">\n            <button class=\"dark-mode-button\"><span><font-awesome-icon icon='sun' size=\"3x\"/></span></button>     \n        </div>\n    </div>\n      <div class=\"row\">\n             <div class=\"graph horizontal-container\">\n                <h3>Outline</h3>\n              </div>\n              <div class=\"col\">\n                  <div class=\"row\">\n                     <div class=\"upload horizontal-container\">\n                        <h3>Upload your graph</h3>\n                        <input class=\"upload-button\" type=\"file\" accept=\"image/*\" @change=\"uploadFile\"/>\n                      </div>\n                      <div class=\"undoRedo horizontal-container\">\n                        <h3>Functional Bar</h3>\n                        <div class=\"button-group\">\n                          <button @click=\"undoHistory\"> Undo </button>\n                          <button @click=\"redoHistory\"> Redo </button>\n                          <button @click=\"onBoundingBoxActive\"> Bounding Box </button>\n                          <button @click=\"logCanvasData\"> Log Canvas </button>\n                        </div>\n                      </div>\n                  </div>\n                  <div class=\"horizontal-container min-height\">\n                    <h3>Graph</h3>\n                    <canvas ref=\"can\"></canvas>\n                  </div>\n              </div>\n      </div>\n      </div>\n    </div>\n    \n   \n</template>\n\n<script>\nimport { fabric } from 'fabric';\nimport BoundingBox from '../assets/BoundingBox.js'\nimport History from '../assets/StateStore.js'\n\n\n\nexport default {\n\n  \n  name: 'imageUpload',\n  props: {\n      canW: {\n          type: [String,Number],\n          required: true\n      },\n      canH: {\n          type: [String,Number],\n          required: true\n      },\n  },\n  data() {\n    return {\n     arr: [\"Poiesis\", \"ποίησις\"],\n      item:{\n          image : null,\n          imageUrl: null\n      },\n      canvas: null,\n      boundingBoxActive: false,\n      bgSet: false,\n    }\n  },\n  mounted() {\n      \n      this.canvas = new fabric.Canvas(this.$refs.can, {selection: false});\n      this.canvas.setDimensions({width: this.canW, height: this.canH});\n      this.history = new History();\n  },\n  methods: {\n    turnOffListeners() {\n      if (this.boundingBoxActive) {\n        this.boundingBoxActive = !this.boundingBoxActive;\n      }\n      this.canvas.off('mouse:down').off('mouse:move').off('mouse:up');\n    },\n    // cursor(el){\n    //   gsap.to(el,{opacity:0,ease:\"power2.inOut\",repeat:-1})\n    // },\n    updateHistory() {\n      this.canvas.renderAll();\n      console.log(JSON.stringify(this.canvas));\n      this.history.push(JSON.stringify(this.canvas));\n    },\n    undoHistory() {\n      this.turnOffListeners();\n      this.canvas.loadFromJSON(this.history.undo());\n    },\n    redoHistory() {\n      this.turnOffListeners();\n      this.canvas.loadFromJSON(this.history.redo());\n    },\n    uploadFile(e) {\n      const file = e.target.files[0];\n      this.item.image = file;\n      this.item.imageUrl = URL.createObjectURL(file);\n      fabric.Image.fromURL(this.item.imageUrl,function(oImg){\n        let imgWidth = oImg.width;\n        let imgHeight = oImg.height;\n        let imgRatio = imgWidth / imgHeight;\n        let canvasRatio = this.canW/this.canH;\n         if(imgRatio <= canvasRatio){\n            if(imgHeight> this.canH){\n              oImg.scaleToHeight(this.canH-10);\n            }\n          }else{\n            if(imgWidth> this.canW){\n              oImg.scaleToWidth(this.canW-10);\n            }\n          }\n      })\n      // this.canvas.drawImage(this.item.imageUrl,0,0,200,200);\n      this.canvas.setBackgroundImage(this.item.imageUrl,this.canvas.renderAll.bind(this.canvas),{width: this.canvas.width, height: this.canvas.height, originX: 'left', originY: 'top'});\n      this.canvas.renderAll();\n      this.bgSet = 1;\n    },\n    onBoundingBoxActive() {\n      if (this.bgSet) {\n        this.updateHistory();\n        this.bgSet = !this.bgSet;\n      }\n      this.boundingBoxActive = !this.boundingBoxActive;\n      BoundingBox(this.canvas, this.boundingBoxActive, this.history);   \n    },\n    logCanvasData() {\n      console.log(JSON.stringify(this.canvas));\n    }\n  },\n\n} \n</script>"]},"metadata":{},"sourceType":"module"}