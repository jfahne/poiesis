{"ast":null,"code":"import { fabric } from 'fabric';\nimport BoundingBox from '../assets/BoundingBox.js';\nimport History from '../assets/StateStore.js';\nexport default {\n  name: 'imageUpload',\n  props: {\n    canW: {\n      type: [String, Number],\n      required: true\n    },\n    canH: {\n      type: [String, Number],\n      required: true\n    }\n  },\n\n  data() {\n    return {\n      canvas: null,\n      boundingBoxActive: false\n    };\n  },\n\n  mounted() {\n    this.canvas = new fabric.Canvas(this.$refs.can, {\n      selection: false\n    });\n    this.canvas.setDimensions({\n      width: this.canW,\n      height: this.canH\n    });\n    this.history = new History();\n  },\n\n  methods: {\n    turnOffListeners() {\n      if (this.boundingBoxActive) {\n        this.boundingBoxActive = !this.boundingBoxActive;\n      }\n\n      this.canvas.off('mouse:down').off('mouse:move').off('mouse:up');\n    },\n\n    updateHistory() {\n      this.canvas.renderAll();\n      console.log(JSON.stringify(this.canvas));\n      this.history.push(JSON.stringify(this.canvas));\n    },\n\n    undoHistory() {\n      this.turnOffListeners();\n      this.canvas.loadFromJSON(this.history.undo());\n    },\n\n    redoHistory() {\n      this.turnOffListeners();\n      this.canvas.loadFromJSON(this.history.redo());\n    },\n\n    onChange(e) {\n      this.uploadFile(e);\n      this.updateHistory();\n    },\n\n    uploadFile(e) {\n      const file = e.target.files[0];\n      var reader = new FileReader();\n\n      reader.onload = function (f) {\n        var data = f.target.result;\n        fabric.Image.fromURL(data, function (img) {\n          this.canvas.setBackgroundImage(img, this.canvas.renderAll.bind(this.canvas), {\n            scaleX: this.canvas.width / img.width,\n            scaleY: this.canvas.height / img.height\n          });\n        });\n      };\n\n      reader.readAsDataURL(file);\n      this.canvas.renderAll();\n    },\n\n    onBoundingBoxActive() {\n      this.boundingBoxActive = !this.boundingBoxActive;\n      BoundingBox(this.canvas, this.boundingBoxActive, this.history);\n    },\n\n    logCanvasData() {\n      console.log(JSON.stringify(this.canvas));\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["fabric","BoundingBox","History","name","props","canW","type","String","Number","required","canH","data","canvas","boundingBoxActive","mounted","Canvas","$refs","can","selection","setDimensions","width","height","history","methods","turnOffListeners","off","updateHistory","renderAll","console","log","JSON","stringify","push","undoHistory","loadFromJSON","undo","redoHistory","redo","onChange","e","uploadFile","file","target","files","reader","FileReader","onload","f","result","Image","fromURL","img","setBackgroundImage","bind","scaleX","scaleY","readAsDataURL","onBoundingBoxActive","logCanvasData"],"sourceRoot":"","sources":["C:\\Users\\joeyf\\Documents\\CIS 671\\poiesis\\src\\components\\UploadButton.vue"],"sourcesContent":["<template>\r\n    <input type=\"file\" accept=\"image/*\" @change=\"onChange\" />\r\n    <button @click=\"onBoundingBoxActive\"> Bounding Box </button>\r\n    <button @click=\"logCanvasData\"> Log Canvas </button>\r\n    <button @click=\"undoHistory\"> Undo </button>\r\n    <button @click=\"redoHistory\"> Redo </button>\r\n    <canvas ref=\"can\"></canvas>\r\n</template>\r\n\r\n<script>\r\nimport { fabric } from 'fabric';\r\nimport BoundingBox from '../assets/BoundingBox.js'\r\nimport History from '../assets/StateStore.js'\r\n\r\nexport default {\r\n  name: 'imageUpload',\r\n  props: {\r\n      canW: {\r\n          type: [String,Number],\r\n          required: true\r\n      },\r\n      canH: {\r\n          type: [String,Number],\r\n          required: true\r\n      },\r\n  },\r\n  data() {\r\n    return {\r\n      canvas: null,\r\n      boundingBoxActive: false,\r\n    };\r\n  },\r\n  mounted() {\r\n      this.canvas = new fabric.Canvas(this.$refs.can, {selection: false});\r\n      this.canvas.setDimensions({width: this.canW, height: this.canH});\r\n      this.history = new History();\r\n  },\r\n  methods: {\r\n    turnOffListeners() {\r\n      if (this.boundingBoxActive) {\r\n        this.boundingBoxActive = !this.boundingBoxActive;\r\n      }\r\n      this.canvas.off('mouse:down').off('mouse:move').off('mouse:up');\r\n    },\r\n    updateHistory() {\r\n      this.canvas.renderAll();\r\n      console.log(JSON.stringify(this.canvas));\r\n      this.history.push(JSON.stringify(this.canvas));\r\n    },\r\n    undoHistory() {\r\n      this.turnOffListeners();\r\n      this.canvas.loadFromJSON(this.history.undo());\r\n    },\r\n    redoHistory() {\r\n      this.turnOffListeners();\r\n      this.canvas.loadFromJSON(this.history.redo());\r\n    },\r\n    onChange(e) {\r\n      this.uploadFile(e);\r\n      this.updateHistory();\r\n    },\r\n    uploadFile(e) {\r\n      const file = e.target.files[0];\r\n      var reader = new FileReader();\r\n      reader.onload = function(f) {\r\n        var data = f.target.result;\r\n        fabric.Image.fromURL(data, function(img) {\r\n          this.canvas.setBackgroundImage(img, this.canvas.renderAll.bind(this.canvas), {\r\n            scaleX: this.canvas.width / img.width,\r\n            scaleY: this.canvas.height / img.height\r\n          });\r\n        });\r\n      };\r\n      reader.readAsDataURL(file)\r\n      this.canvas.renderAll();\r\n    },\r\n    onBoundingBoxActive() {\r\n      this.boundingBoxActive = !this.boundingBoxActive;\r\n      BoundingBox(this.canvas, this.boundingBoxActive, this.history);   \r\n    },\r\n    logCanvasData() {\r\n      console.log(JSON.stringify(this.canvas));\r\n    }\r\n  },\r\n\r\n} \r\n</script>"]},"metadata":{},"sourceType":"module"}